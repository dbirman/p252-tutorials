---
title: 'Psych 252: R Tutorial Module 3'
output:
  html_document:
    highlight: pygments
    theme: flatly
    toc: yes
---

Based on notes by Paul Thibodeau (2009) and revisions by the Psych 252 instructors in 2010 and 2011

Expanded in 2012 by Mike Frank, Benoit Monin and Ewart Thomas

Converted to [R Markdown](http://www.rstudio.com/ide/docs/r_markdown) format and further expanded in 2013 by Steph Gagnon.



### Generate boxplots from short-form data

Now let's take a quick peek at this data. Since d0s is in short-form, we need to make some changes before boxplot can generate a plot for us. We'll start by making a variable by combining the data in the variable d0s$col0 with the data in d0s$col1:

```{r combine_cols_d0s}
col = c(d0s$col0, d0s$col1)
col
```

Then, we'll use the `rep()` (short for "repeat") function to make a long vector of 0s and 1s signifying RTWL status. Each vector should be 14 numbers long, since there were 14 cities total:

```{r rep_rtwl_d0s}
rtwl = rep(c(0, 1), each = 14)
rtwl
```

Now, we'll combine these variables to make a dataframe; there will be 2 variables, *(1)* the cost of living for the 14 cities before & after the RTWL was passed, and *(2)* the status of the RTWL:

```{r create_d0l}
d0l = data.frame(cbind(col = col, rtwl = rtwl))
d0l
```

Finally,  we can create a boxplot:

```{r plot_col_on_rtwl_paired, fig.width=4, fig.height=3}
boxplot(col ~ rtwl, col='lightgreen', 
        pch=23, 
        xlab = "RTWL", ylab = "COL",
        main='COL vs RTWL, paired data',
        data=d0l)
```


Exploring Repeated Measures Exercise Data
-----------------------------------------

Here, we'll start by loading in the packages we introduced in lecture 2:

```{r load_ggplot_reshape}
library(ggplot2)
library(reshape2)
```

### Running a source file

Next, we're going to run a source file `mc.plots1.r` to change around some plotting parameters, including loading in the 'grid' package. Calling `source()` runs all the code in the .R file.


```{r source_plots1}
source('http://stanford.edu/class/psych252/tutorials/mc.plots1.r')
```

### Exercise data

Now, we'll load in the data file `exer.csv`. Here, participants (*n* = 30) were randomly assigned to two different diets: low-fat (`diet` = 1) and not low-fat (`diet` = 2), and three different types of exercise: at rest (`exertype` = 1), walking leisurely (`exertype` = 2), and running (`exertype` = 3).  Their pulse rate (`pulse`) was measured at three different time points during their assigned exercise: at 1 minute (`time` = 1), 15 minutes (`time` = 2), and 30 minutes (`time` = 3).  This is a *repeated measures* design, with `time` as the *within-subject* (repeated) variable.  **How does pulse depend on time, diet and exertype?**


```{r load_d2}
d2 <- read.csv('http://stanford.edu/class/psych252/data/exer.csv')
str(d2)
summary(d2)
```

We can see that all the variables are integers since the raw data entries began with numbers, even though some should be factors. We want to convert `id`, `diet`, and `exertype` to factors with informative levels:

```{r setfactors_d2}
d2$diet <- factor(d2$diet, labels=c('lo.fat','non.lo.fat'))
d2$id <- factor(d2$id)
d2$exertype <- factor(d2$exertype, labels=c('rest','walk','run'))

summary(d2) # double check formatting
```

### Plot exercise data
Now, we'll use `ggplot2`'s `qplot()` function to plot the subjects' pulse over time points 1-3 for each of the 6 groups (diet type X exercise type):

```{r qplot_tim_on_pulse_facets, fig.width=7, fig.height=5}
qp3 = qplot(time, pulse, facets = diet ~ exertype, colour = id,
            geom = "line", data=d2) + 
      theme_bw() + plot.style
print(qp3)
```

### Bar graphs

We might also want to visualize this data in bar graph form. To do this with ggplot, we'll use the `aggregate()` function to get means and standard errors from the data.

First, we'll extract the mean pulses across subjects for each of the 6 groups at all three time points:

```{r means_d2}
ms <- aggregate(pulse ~ time + diet + exertype, d2, mean)
ms
```

Now, we'll get the standard error of the mean. We'll do this using the function `se.mean()` defined in the script 'mc.plots1.r'. The function is elaborated below:

```{r sterr_d2}
ms$err = aggregate(pulse ~ time + diet + exertype, d2, 
                    FUN = se.mean)$pulse

# This is the same as the function se.mean()
ms$err = aggregate(pulse ~ time + diet + exertype, d2, 
                   function(x) {sd(x) / sqrt(length(x))})$pulse

ms
```

Finally, we plot the bar graph:
```{r qlot_time_on_pulse_facet_bars, fig.width=7, fig.height=5}
qp4 <- qplot(time, pulse, facets = . ~ diet, ymin=pulse - err, ymax=pulse + err, 
  geom=c("pointrange","line"), colour=exertype, data=ms) + 
  theme_bw() + plot.style
print(qp4)
```
